<div style="max-width:520px;margin:auto;font-family:system-ui,Arial,sans-serif;text-align:center;">
  <h2 style="margin-bottom:6px"> Small Distance Friis + Malus Predictions Interactive</h2>
  <div style="font-size:13px;color:#334155;margin-bottom:8px;">
    Pr shown in <strong>dBm</strong> and <strong>mW</strong>
  </div>

  <div style="position:relative;height:90px;margin-bottom:10px;">
    <div style="position:absolute;left:0;top:18px;font-size:40px;">üì°</div>
<!-- Simple animated sine wave -->
<svg id="sinewave" width="100%" height="60" viewBox="0 0 300 60"
     style="position:absolute; left:60px; right:60px; top:28px;">
  <path id="wavePath"
        d="M0 30 Q 25 0, 50 30 T 100 30 T 150 30 T 200 30 T 250 30 T 300 30"
        stroke="rgba(0,140,255,0.85)"
        stroke-width="3"
        fill="none">
    <animate attributeName="d"
             dur="1.8s"
             repeatCount="indefinite"
             values="
               M0 30 Q 25 0, 50 30 T 100 30 T 150 30 T 200 30 T 250 30 T 300 30;
               M0 30 Q 25 60, 50 30 T 100 30 T 150 30 T 200 30 T 250 30 T 300 30;
               M0 30 Q 25 0, 50 30 T 100 30 T 150 30 T 200 30 T 250 30 T 300 30
             " />
  </path>
</svg>
    <div id="rx" style="position:absolute;right:0;top:18px;font-size:40px;"> üì°</div>
  </div>
  <style>
    @keyframes waveMove{from{background-position:0 0}to{background-position:32px 0}}
  </style>

  <!-- Controls -->
  <div style="text-align:left; padding:10px; border-radius:10px; background:#fff; box-shadow:0 6px 18px rgba(2,6,23,0.06);">
    <label style="font-size:13px">Transmitted power, Pt (dBm)</label>
    <input id="pt" type="number" value="0" step="0.1" style="width:100%;margin-bottom:8px"/>

    <div style="display:flex;gap:8px;">
      <div style="flex:1">
        <label style="font-size:13px">Tx gain Gt (dBi)</label>
        <input id="gt" type="number" value="2.15" step="0.1" style="width:100%"/>
      </div>
      <div style="flex:1">
        <label style="font-size:13px">Rx gain Gr (dBi)</label>
        <input id="gr" type="number" value="2.15" step="0.1" style="width:100%"/>
      </div>
    </div>

    <label style="font-size:13px;margin-top:8px">Wavelength Œª (m) ‚Äî 1 GHz ‚âà 0.30 m</label>
    <input id="lambda" type="number" value="0.30" step="0.01" style="width:100%;margin-bottom:8px"/>

    <label style="font-size:13px">Distance R (m)</label>
    <input id="dist" type="range" min="0.3" max="3" step="0.01" value="0.35" style="width:100%"/>
    <div style="display:flex;justify-content:space-between">
      <small>R = <span id="distVal">0.35</span> m</small>
      <small>Œª/(4œÄR) factor shown below</small>
    </div>

    <label style="font-size:13px;margin-top:10px">Receiver rotation Œ∏ (¬∞)</label>
    <input id="ang" type="range" min="0" max="90" value="0" step="1" style="width:100%"/>
    <div style="display:flex;justify-content:space-between"><small>Œ∏ = <span id="angVal">0</span>¬∞</small><small></small></div>
  </div>

  <!-- Outputs -->
  <div style="margin-top:12px;text-align:left">
    <div style="background:#fff;padding:10px;border-radius:10px;box-shadow:0 6px 18px rgba(2,6,23,0.06)">
      <div style="display:flex;justify-content:space-between">
        <div>
          <div style="font-weight:600">Friis (no polarization)</div>
          <div style="font-size:13px;color:#374151">Pr‚ÇçFriis‚Çé = Pt + Gt + Gr + 20¬∑log‚ÇÅ‚ÇÄ(Œª / (4œÄR))</div>
        </div>
        <div style="text-align:right">
          <div id="prFriis_dBm" style="font-size:18px;font-weight:700">-</div>
          <div style="font-size:12px;color:#475569" id="prFriis_mW">- mW</div>
        </div>
      </div>

      <hr style="margin:10px 0"/>

      <div style="display:flex;justify-content:space-between">
        <div>
          <div style="font-weight:600">After Malus (polarization)</div>
          <div style="font-size:13px;color:#374151">Adjustment = 10¬∑log‚ÇÅ‚ÇÄ(cos¬≤Œ∏) (dB)</div>
        </div>
        <div style="text-align:right">
          <div id="malusDB" style="font-size:18px;font-weight:700">- dB</div>
        </div>
      </div>

      <hr style="margin:10px 0"/>

      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div style="font-weight:700">Predicted received power</div>
          <div style="font-size:13px;color:#374151">Pr = Friis + Malus adjustment</div>
        </div>
        <div style="text-align:right">
          <div id="prTotal_dBm" style="font-size:20px;font-weight:800">- dBm</div>
          <div id="prTotal_mW" style="font-size:12px;color:#475569">- mW</div>
        </div>
      </div>

      <div style="height:12px;background:#e6eef8;border-radius:8px;margin-top:10px;overflow:hidden">
        <div id="bar" style="height:100%;width:100%;background:#2563eb;transition:width 0.18s"></div>
      </div>
    </div>
  </div>

  <!-- Equations summary (plain text, accurate) -->
  <div style="text-align:left;font-size:13px;color:#334155;margin-top:10px">
    <strong>Notes / units</strong>
    <ul style="margin:6px 0 0 18px;padding:0">
      <li>All dB numbers are in decibels: <em>dBm</em> and mW = 10^(dBm/10).</li>
      <li>Malus: cos¬≤Œ∏ multiplies linear power. In dB we add 10¬∑log‚ÇÅ‚ÇÄ(cos¬≤Œ∏).</li>
      <li>At Œ∏ = 90¬∞ the theoretical received power goes to 0 (so negative infinite dB). So the value given above for Œ∏ = 90¬∞ isn't exactly correct</li>
    </ul>
  </div>
</div>

<script>
  // DOM
  const ptEl = document.getElementById('pt');
  const gtEl = document.getElementById('gt');
  const grEl = document.getElementById('gr');
  const lambdaEl = document.getElementById('lambda');
  const distEl = document.getElementById('dist');
  const angEl = document.getElementById('ang');

  const distVal = document.getElementById('distVal');
  const angVal = document.getElementById('angVal');

  const prFriis_dBmEl = document.getElementById('prFriis_dBm');
  const prFriis_mWEl = document.getElementById('prFriis_mW');
  const malusDBEl = document.getElementById('malusDB');
  const prTotal_dBmEl = document.getElementById('prTotal_dBm');
  const prTotal_mWEl = document.getElementById('prTotal_mW');
  const barEl = document.getElementById('bar');
  const rx = document.getElementById('rx');

  // helpers
  function dBm_to_mW(dBm){ return Math.pow(10, dBm/10); }
  function mW_to_dBm(mW){ return 10*Math.log10(Math.max(mW, 1e-30)); }

  function update(){
    const Pt = parseFloat(ptEl.value); // dBm
    const Gt = parseFloat(gtEl.value);
    const Gr = parseFloat(grEl.value);
    const lambda = parseFloat(lambdaEl.value); // m
    const R = parseFloat(distEl.value);
    const theta_deg = parseFloat(angEl.value);
    distVal.textContent = R.toFixed(2);
    angVal.textContent = theta_deg;

    // rotate rx icon for visuals
    rx.style.transform = `rotate(${theta_deg}deg)`;

    // Friis in dBm: Pt + Gt + Gr + 20 log10(lambda/(4œÄR))
    const term = 20*Math.log10(lambda/(4*Math.PI*R));
    const prFriis_dBm = Pt + Gt + Gr + term;

    // Malus adjustment in dB: 10 log10(cos^2 theta)
    const theta = theta_deg * Math.PI / 180;
    let cos2 = Math.cos(theta) ** 2;
    if(cos2 < 1e-30) cos2 = 1e-30; // avoid -Inf, clip to tiny number
    const malus_dB = 10 * Math.log10(cos2);

    // Combined
    const prTotal_dBm = prFriis_dBm + malus_dB;

    // mW conversions
    const prFriis_mW = dBm_to_mW(prFriis_dBm);
    const prTotal_mW = dBm_to_mW(prTotal_dBm);

    // Update UI (formatting)
    prFriis_dBmEl.textContent = prFriis_dBm.toFixed(2) + " dBm";
    prFriis_mWEl.textContent = prFriis_mW.toExponential(3) + " mW";

    malusDBEl.textContent = malus_dB.toFixed(2) + " dB";

    prTotal_dBmEl.textContent = prTotal_dBm.toFixed(2) + " dBm";
    prTotal_mWEl.textContent = prTotal_mW.toExponential(3) + " mW";

    // bar: map prTotal_mW to a reasonable percent for visualization
    // pick a normalization scale so bar is visible for typical small powers
    const scale = 1e-3; // 1 mW baseline -> 100%
    const pct = Math.min(100, (prTotal_mW / scale) * 100);
    barEl.style.width = pct + "%";
  }

  [ptEl, gtEl, grEl, lambdaEl, distEl, angEl].forEach(el => el.addEventListener('input', update));
  update();
</script>
